parameters:
  - name: resourceConfiguration
    type: object

jobs:
  - job: databricksbuild
    displayName: Azure Databricks Build
    steps:

    - task: CopyFiles@2
      inputs:
        sourceFolder: '$(Build.SourcesDirectory)\examples\databricks\src\'
        contents: '**' 
        targetFolder: '$(Build.ArtifactStagingDirectory)\application\databricks\src\'
      displayName: 'Copy Databricks Application'

    - task: CopyFiles@2
      inputs:
        sourceFolder: '$(Build.SourcesDirectory)\examples\databricks\configuration\'
        contents: '**' 
        targetFolder: '$(Build.ArtifactStagingDirectory)\application\databricks\configuration\'
      displayName: 'Copy Databricks Configuration Files'
    
    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.ArtifactStagingDirectory)\application\'
        artifactName: application
      displayName: 'Publish Databricks'

    - ${{ if eq(parameters.resourceConfiguration.infrastructure.enabled, true) }}:
        - template: .\infrastructure-build-steps.yml
          parameters:
            resourceConfiguration: ${{ parameters.resourceConfiguration }}